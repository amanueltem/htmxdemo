<div id="main-content-wrapper" th:fragment="deposit-table-container">
    <div class="content-header">
        <h2>Deposit Dashboard</h2>
        <button sec:authorize="hasRole('INPUTTER')"
                class="btn btn-primary"
                hx-get="/deposits/new"
                hx-target="#modals-here">
            + New Deposit
        </button>
    </div>

    <div class="card-container">
        <table class="data-table">
            <thead>
            <tr>
                <th>Date</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Inputter</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="deposit : ${depositList}">
                <td th:text="${deposit.date}"></td>
                <td th:text="${deposit.amountFormatted}"></td>
                <td>
                    <span class="status-badge"
                          th:classappend="${deposit.status == 'AUTHORIZED' ? 'status-success' : 'status-warning'}"
                          th:text="${deposit.status}">
                    </span>
                </td>
                <td th:text="${deposit.inputter}"></td>
                <td>
                    <div class="action-group" style="display: flex; gap: 5px;">
                        <button th:if="${deposit.canEdit}"
                                class="btn btn-outline btn-sm"
                                th:hx-get="@{/deposits/edit/{id}(id=${deposit.id})}"
                                hx-target="#modals-here">Edit</button>

                        <button th:if="${deposit.canDelete}"
                                class="btn btn-danger btn-sm"
                                th:hx-delete="@{/deposits/{id}(id=${deposit.id})}"
                                hx-target="#main-content-wrapper"
                                hx-swap="outerHTML"
                                hx-confirm="Delete?">Delete</button>

                        <button th:if="${deposit.canAuthorize}"
                                sec:authorize="hasRole('AUTHORIZER')"
                                class="btn btn-primary btn-sm"
                                th:hx-post="@{/deposits/{id}/authorize(id=${deposit.id})}"
                                hx-target="#main-content-wrapper"
                                hx-swap="outerHTML">Authorize</button>

                        <button th:if="${deposit.canRequestEdit}"
                                class="btn btn-warning btn-sm"
                                th:hx-get="@{/deposits/{id}/edit-request(id=${deposit.id})}"
                                hx-target="#modals-here">Edit Request</button>

                        <button th:if="${deposit.canAcceptEditRequest}"
                                class="btn btn-success btn-sm"
                                th:hx-post="@{/deposits/{id}/accept-edit-request(id=${deposit.id})}"
                                hx-target="#main-content-wrapper"
                                hx-swap="outerHTML">Accept Edit</button>
                    </div>
                </td>
            </tr>
            <tr th:if="${totalElements == 0}">
                <td colspan="5" style="text-align: center; padding: 2rem;">No records found.</td>
            </tr>
            </tbody>
        </table>

        <div class="pagination-bar" th:if="${totalPages > 1}">
            <button th:if="${hasPrev}"
                    class="btn btn-outline btn-sm"
                    th:hx-get="@{/deposits(page=${currentPage - 1})}"
                    hx-target="#main-content-wrapper" hx-swap="outerHTML">Previous</button>

            <span th:text="'Page ' + (${currentPage} + 1) + ' of ' + ${totalPages}"></span>

            <button th:if="${hasNext}"
                    class="btn btn-outline btn-sm"
                    th:hx-get="@{/deposits(page=${currentPage + 1})}"
                    hx-target="#main-content-wrapper" hx-swap="outerHTML">Next</button>
        </div>
    </div>
    <div id="modals-here"></div>
</div>