<div id="main-content-wrapper" th:fragment="expense-table-container">
    <div class="content-header">
        <h2>Expense Dashboard</h2>
        <button sec:authorize="hasRole('INPUTTER')"
                class="btn btn-primary"
                hx-get="/expenses/new"
                hx-target="#modals-here">
            + New Expense
        </button>
    </div>

    <div class="card-container">
        <table class="data-table">
            <thead>
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Inputter</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="expense : ${expenses.getContent()}">
                <td data-label="Date" th:text="${expense.date()}"></td>
                <td data-label="Time" th:text="${expense.timeSpan()}"></td>
                <td data-label="Amount" th:text="${expense.amountFormatted()}"></td>
                <td data-label="Status">
                    <span class="status-badge"
                          th:classappend="${expense.isAuthorized() ? 'status-success' : 'status-warning'}"
                          th:text="${expense.status()}"></span>
                </td>
                <td data-label="Inputter" th:text="${expense.inputter()}"></td>
                <td data-label="Actions">
                    <div class="action-group" style="display: flex; gap: 5px;">

                        <button th:if="${expense.canEdit()}"
                                sec:authorize="hasRole('INPUTTER')"
                                class="btn btn-outline btn-sm"
                                th:hx-get="@{/expenses/edit/{id}(id=${expense.id()})}"
                                hx-target="#modals-here">Edit</button>

                        <button th:if="${expense.canDelete()}"
                                sec:authorize="hasRole('INPUTTER')"
                                class="btn btn-danger btn-sm"
                                th:hx-delete="@{/expenses/{id}(id=${expense.id()})}"
                                hx-target="#main-content-wrapper"
                                hx-swap="outerHTML"
                                hx-confirm="Confirm Deletion?">Delete</button>

                        <button th:if="${expense.canAuthorize()}"
                                sec:authorize="hasRole('AUTHORIZER')"
                                class="btn btn-primary btn-sm"
                                th:hx-post="@{/expenses/{id}/authorize(id=${expense.id()})}"
                                hx-target="#main-content-wrapper"
                                hx-swap="outerHTML">Authorize</button>

                        <button th:if="${expense.canRequestEdit()}"
                                sec:authorize="hasRole('INPUTTER')"
                                class="btn btn-warning btn-sm"
                                th:hx-get="@{/expenses/{id}/edit-request(id=${expense.id()})}"
                                hx-target="#modals-here">Edit Request</button>

                        <button th:if="${expense.canAcceptEditRequest()}"
                                sec:authorize="hasRole('AUTHORIZER')"
                                class="btn btn-success btn-sm"
                                th:hx-post="@{/expenses/{id}/accept-edit-request(id=${expense.id()})}"
                                hx-target="#main-content-wrapper"
                                hx-swap="outerHTML"
                                hx-confirm="Accept edit request?">Accept Edit</button>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>

        <div class="pagination-bar" th:if="${expenses.getTotalPages() > 1}">
            <button th:if="${expenses.hasPrevious()}" class="btn btn-outline btn-sm"
                    th:hx-get="@{/expenses(page=${expenses.getNumber() - 1})}"
                    hx-target="#main-content-wrapper" hx-swap="outerHTML">Previous</button>

            <span th:text="'Page ' + (${expenses.getNumber()} + 1) + ' of ' + ${expenses.getTotalPages()}"></span>

            <button th:if="${expenses.hasNext()}" class="btn btn-outline btn-sm"
                    th:hx-get="@{/expenses(page=${expenses.getNumber() + 1})}"
                    hx-target="#main-content-wrapper" hx-swap="outerHTML">Next</button>
        </div>
    </div>
    <div id="modals-here"></div>
</div>