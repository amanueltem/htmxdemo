<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>HTMX + Spring Boot</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>

    <!-- Spring Security CSRF -->
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>
<body hx-boost="true">

<script>
    // Automatically attach CSRF token to every htmx request
    document.body.addEventListener('htmx:configRequest', function (event) {
        const token = document.querySelector('meta[name="_csrf"]').content;
        const header = document.querySelector('meta[name="_csrf_header"]').content;
        event.detail.headers[header] = token;
    });
</script>

<div class="container">
    <h1>My Tasks</h1>

    <form hx-post="/add-task"
          hx-target="#task-list-container"
          hx-swap="innerHTML"
          hx-on::after-request="this.reset()">
        <input type="text" name="taskName" placeholder="What needs to be done?" required>
        <button type="submit">Add Task</button>
    </form>

    <div id="task-list-container">
        <ul id="task-list" th:fragment="task-list">
            <li th:each="task, iter : ${tasks}" th:id="'task-' + ${iter.index}">
                <span th:text="${task}">Task Name</span>
                <button class="delete-btn"
                        th:hx-delete="'/delete-task/' + ${iter.index}"
                        th:hx-target="'#task-' + ${iter.index}"
                        hx-swap="outerHTML">
                    Delete
                </button>
            </li>
        </ul>
    </div>
</div>

</body>
</html>
